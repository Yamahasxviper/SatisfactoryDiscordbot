; ===========================================================================================
; DEPENDENCY EXPLANATION - WebSockets Module
; ===========================================================================================
; Technical explanation of the WebSockets dependency
; ===========================================================================================

[Overview]
Title=WebSockets Dependency Explanation
Question=Why use the built-in WebSockets module?
Answer=The mod uses the built-in WebSockets module from Unreal Engine instead of custom plugins

; ===========================================================================================
; WHY BUILT-IN WEBSOCKETS?
; ===========================================================================================

[Reason1_Stability]
Title=Stability and Maintenance
Benefit1=Maintained and tested by Epic Games
Benefit2=Well-integrated with Unreal Engine
Benefit3=Widely used in production projects
Benefit4=Automatically updated with engine updates

[Reason2_SimplerAPI]
Title=Simpler API
Benefit1=Delegate-based event system (simpler than callbacks)
Benefit2=Automatic connection management
Benefit3=Built-in ticking (no manual tick required)
Benefit4=String-based message handling (easier for JSON)

; ===========================================================================================
; WEBSOCKETS CONFIGURATION
; ===========================================================================================

[Config_ProjectLevel]
Level=Project Level
File=FactoryGame.uproject
Configuration={"Name": "WebSockets", "Enabled": true, "Optional": true}
Purpose=Enables the WebSockets plugin for the entire Unreal Engine project
Note=Marked as optional so project can build even if WebSockets not available
Fallback=If WebSockets unavailable, only DiscordChatBridge mod will fail to load

[Config_ModPluginLevel]
Level=Mod Plugin Level
File=DiscordChatBridge.uplugin
Configuration={"Name": "WebSockets", "Enabled": true, "Optional": true}
Purpose=Declares that DiscordChatBridge mod uses WebSockets plugin
Note=Marked as optional so mod can load even without WebSockets
Fallback=Gateway/WebSocket features will not work without WebSockets

[Config_ModModuleLevel]
Level=Mod Module Level
File=DiscordChatBridge.Build.cs
Configuration=PublicDependencyModuleNames.AddRange("WebSockets")
Purpose=Tells Unreal Build Tool to link against WebSockets module
Note=Required for compilation when WebSockets features are used

; ===========================================================================================
; DEPENDENCY ISOLATION
; ===========================================================================================

[Isolation_BaseGame]
Module=FactoryGame
UsesWebSockets=No
Reason=Base game module only includes dependencies it directly uses
NoIncludes=No #include "IWebSocket.h" or similar includes
NoCalls=No FWebSocketsModule::Get() calls
NoCode=No WebSocket-related code

[Isolation_Mod]
Module=DiscordChatBridge
UsesWebSockets=Yes
Reason=Mod declares its own dependencies independently
Purpose=Keeps dependencies clean and prevents unnecessary coupling
BestPractice=Each module only includes what it needs

; ===========================================================================================
; HOW WEBSOCKETS IS USED
; ===========================================================================================

[Usage_DiscordGateway]
Feature=Discord Gateway Connection
Purpose=Real-time communication with Discord
Files=DiscordGateway.h and DiscordGateway.cpp
Connection=wss://gateway.discord.gg
Protocol=Discord Gateway API v10

[Usage_BotPresence]
Feature=Bot Presence Updates
Purpose=Shows "Playing with X players" in Discord member list
Method=PRESENCE_UPDATE opcode via WebSocket
UpdateFrequency=Configurable via ActivityUpdateIntervalSeconds
Requirement=Presence Intent enabled in Discord Developer Portal

[Usage_Heartbeat]
Feature=Connection Heartbeat
Purpose=Keeps WebSocket connection alive
Interval=Approximately 40 seconds (server-specified)
AutomaticReconnect=Yes, on connection loss

; ===========================================================================================
; WEBSOCKET AVAILABILITY
; ===========================================================================================

[Availability_BuiltWithEngine]
Scenario=WebSockets built with Unreal Engine
Availability=Yes (default)
EngineVersions=UE 5.3.2-CSS, UE 5.3.2 from Epic
Location_Windows=<UE_ROOT>\Engine\Plugins\Runtime\WebSockets\
Location_Linux=<UE_ROOT>/Engine/Plugins/Runtime/WebSockets/
Note=WebSockets is a standard Unreal Engine plugin

[Availability_MissingFromEngine]
Scenario=WebSockets not in engine installation
Availability=No
Impact=DiscordChatBridge builds WITHOUT Gateway features
FallbackMode=REST API only (HTTP requests for messages)
MissingFeatures=Bot presence, real-time Gateway connection
StillWorks=Yes, basic chat functionality still works

; ===========================================================================================
; BUILD SYSTEM DETECTION
; ===========================================================================================

[BuildSystem_AutoDetection]
Feature=Automatic WebSockets Detection
Implementation=DiscordChatBridge.Build.cs
Method=Checks if WebSockets plugin exists in engine
WithWebSockets=Full functionality (Gateway + REST)
WithoutWebSockets=Basic functionality (REST only)
NoErrors=Builds successfully in both cases

[BuildSystem_ConditionalCompilation]
Feature=Conditional Compilation
PreprocessorDefine=WITH_WEBSOCKETS
UsedIn=DiscordGateway.cpp
Purpose=Compile Gateway code only when WebSockets available
Benefit=Single codebase works with or without WebSockets

; ===========================================================================================
; GATEWAY VS REST COMPARISON
; ===========================================================================================

[Comparison_Gateway]
Mode=Gateway (WebSocket)
Connection=Persistent WebSocket connection
BotPresence=Native Discord presence (shows in member list)
Updates=Real-time via WebSocket
Resources=Higher (persistent connection)
Features=Full Discord Gateway API access
RequiresWebSockets=Yes

[Comparison_REST]
Mode=REST API (HTTP)
Connection=HTTP requests only
BotPresence=Channel messages (posts to chat)
Updates=Polling-based
Resources=Lower (stateless requests)
Features=Basic message send/receive
RequiresWebSockets=No

; ===========================================================================================
; TROUBLESHOOTING
; ===========================================================================================

[Troubleshooting_BuildErrors]
Issue=Build errors about WebSockets not found
Cause=WebSockets plugin not in engine installation
Solution1=Use Unreal Engine 5.3.2-CSS (includes WebSockets)
Solution2=Use standard UE 5.3.2 from Epic (includes WebSockets)
Solution3=Build UE from source (WebSockets compiles automatically)
Solution4=Use the mod without Gateway features (REST only)

[Troubleshooting_GatewayNotWorking]
Issue=Gateway features not working
Check1=Verify WebSockets plugin is in engine installation
Check2=Check UseGatewayForPresence=true in config
Check3=Verify Presence Intent enabled in Discord Developer Portal
Check4=Review server logs for WebSocket connection messages
Check5=Ensure firewall allows WebSocket connections

[Troubleshooting_CompilationWarnings]
Issue=Warnings about WebSockets during compilation
Expected=This is normal if WebSockets not available
Impact=Mod builds successfully but without Gateway features
Logs=Check for "WebSockets not found, building without Gateway support"
NoAction=No action needed unless you want Gateway features

; ===========================================================================================
; TECHNICAL DETAILS
; ===========================================================================================

[Technical_WebSocketProtocol]
Protocol=WSS (WebSocket Secure)
Endpoint=wss://gateway.discord.gg
Port=443
Encryption=TLS/SSL
Compression=Optional (zlib-stream)

[Technical_DiscordGateway]
APIVersion=v10
Intents=GUILD_MESSAGES, MESSAGE_CONTENT, GUILDS
Opcodes=HELLO, IDENTIFY, HEARTBEAT, HEARTBEAT_ACK, PRESENCE_UPDATE
Reconnection=Automatic with exponential backoff
SessionResumption=Supported

[Technical_MessageFormat]
Format=JSON
Encoding=UTF-8
PayloadType=Text (not binary)
MaxSize=4096 bytes per message

; ===========================================================================================
; ADDITIONAL RESOURCES
; ===========================================================================================

[Resources]
BuildRequirements=See BUILD_REQUIREMENTS.md for engine requirements
CompilationFix=See COMPILATION_FIX.ini for build troubleshooting
TechnicalArchitecture=See TECHNICAL_ARCHITECTURE.ini for implementation details
SetupGuide=See SETUP_GUIDE.ini for configuration instructions
