; ===========================================================================================
; TECHNICAL ARCHITECTURE - Discord Chat Bridge
; ===========================================================================================
; Technical implementation details of the server-side only architecture
; ===========================================================================================

[Overview]
Title=Technical Architecture
Purpose=Server-side only implementation
PlayerRequirement=Players do NOT need to install this mod or SML
TechnicalApproach=Two-part solution: Plugin descriptor + Replication policy

; ===========================================================================================
; PART 1: PLUGIN DESCRIPTOR - RequiredOnRemote Field
; ===========================================================================================

[PluginDescriptor_Configuration]
File=DiscordChatBridge.uplugin
Line=19
Configuration=RequiredOnRemote: false
Purpose=Tells SML mod is optional on remote clients
CriticalField=Yes, without this SML will reject clients without the mod
DefaultValue=true (if field missing)

[PluginDescriptor_Impact]
WithField=Clients can join without mod installed
WithoutField=SML rejects clients that don't have the mod
SMLBehavior=Checks during connection handshake
NetworkLayer=SML network manager validates mod requirements

[PluginDescriptor_SMLSource]
SourceFile=Mods/SML/Source/SML/Private/ModLoading/ModLoadingLibrary.cpp
Line_ReadField=47
Code_ReadField=Source->TryGetBoolField(TEXT("RequiredOnRemote"), bRequiredOnRemote)
Line_Default=19
Code_Default=this->bRequiredOnRemote = true
Note=SML defaults to requiring mod on remote if field not specified

; ===========================================================================================
; PART 2: REPLICATION POLICY
; ===========================================================================================

[ReplicationPolicy_Configuration]
File=Source/DiscordChatBridge/Private/DiscordChatSubsystem.cpp
Line=15
Code=ReplicationPolicy = ESubsystemReplicationPolicy::SpawnOnServer
Purpose=Subsystem spawns only on server with no replication to clients

[ReplicationPolicy_Definition]
DefinitionFile=Mods/SML/Source/SML/Public/Subsystem/ModSubsystem.h
Lines=9-10
PolicyName=SpawnOnServer
Description=Subsystem will be spawned on server and will not be replicated to remote clients
ServerBehavior=Spawns on server
ClientBehavior=Does NOT spawn on clients
ReplicationBehavior=Does NOT replicate to clients

[ReplicationPolicy_Options]
Option1=SpawnOnServer - Server only, no replication
Option2=SpawnOnClient - Client only, no server spawn
Option3=SpawnOnServerAndReplicate - Server spawns and replicates to clients
Option4=SpawnOnClientAndServer - Spawns on both (not recommended for this use case)

; ===========================================================================================
; MODULE TYPE
; ===========================================================================================

[ModuleType_Configuration]
File=DiscordChatBridge.uplugin
Lines=21-24
ModuleName=DiscordChatBridge
ModuleType=Runtime
LoadingPhase=PostDefault
Note=Runtime type loads during normal game runtime

[ModuleType_Explanation]
RuntimeType=Loads during normal game runtime
ReplicationControl=Replication policy controls where it spawns
ServerLoading=Always loads on dedicated server
ClientLoading=Only loads if required by replication policy

; ===========================================================================================
; THE TWO-PART SOLUTION
; ===========================================================================================

[TwoPartSolution_Overview]
Requirement=BOTH parts must be configured for server-side only mod
Part1=Plugin Descriptor (SML Network Layer)
Part2=Code Replication Policy (Unreal Spawning)
BothRequired=Yes! Without Part 1, clients blocked by SML before spawning

[TwoPartSolution_Part1]
Part=Plugin Descriptor (SML Network Layer)
Configuration=RequiredOnRemote: false
Purpose=Tells SML clients can join without mod
Layer=SML network manager connection handshake
WithoutThis=Clients blocked during connection

[TwoPartSolution_Part2]
Part=Code Replication Policy (Unreal Spawning)
Configuration=ReplicationPolicy = ESubsystemReplicationPolicy::SpawnOnServer
Purpose=Tells Unreal/SML where to spawn subsystem
Layer=Unreal actor spawning system
WithoutThis=Subsystem might spawn on clients (if SML allows connection)

; ===========================================================================================
; HOW IT WORKS - SERVER BEHAVIOR
; ===========================================================================================

[ServerBehavior_Step1]
Step=1
Action=Server loads SML (Satisfactory Mod Loader)
Component=SML initialization

[ServerBehavior_Step2]
Step=2
Action=SML spawns ADiscordChatSubsystem
Reason=SpawnOnServer replication policy
ActorType=ModSubsystem actor

[ServerBehavior_Step3]
Step=3
Action=Subsystem initializes Discord API connection
Component=DiscordAPI initialization
Operations=Load config, connect to Discord, start polling

[ServerBehavior_Step4]
Step=4
Action=Subsystem binds to game chat events
Component=AFGChatManager integration
Events=OnChatMessageAdded

[ServerBehavior_Step5]
Step=5
Action=Discord messages forwarded to game chat
Flow=Discord → DiscordAPI → Subsystem → ChatManager
Visible=All connected players see messages

[ServerBehavior_Step6]
Step=6
Action=Game messages forwarded to Discord
Flow=ChatManager → Subsystem → DiscordAPI → Discord
Visible=Discord channel shows messages

; ===========================================================================================
; HOW IT WORKS - CLIENT BEHAVIOR
; ===========================================================================================

[ClientBehavior_Step1]
Step=1
Action=Client attempts to connect to server
Check=SML validates mod requirements

[ClientBehavior_Step2]
Step=2
Action=SML checks RequiredOnRemote field
Value=false
Result=Connection allowed without mod

[ClientBehavior_Step3]
Step=3
Action=Client successfully connects
Mods=Client doesn't have DiscordChatBridge mod
GameState=Normal vanilla gameplay

[ClientBehavior_Step4]
Step=4
Action=ADiscordChatSubsystem NOT spawned on client
Reason=SpawnOnServer policy
ClientActor=Does not exist on client

[ClientBehavior_Step5]
Step=5
Action=Client receives game chat messages normally
Source=Server's AFGChatManager replicates chat
DiscordMessages=Appear in game chat with [Discord] prefix

[ClientBehavior_Step6]
Step=6
Action=Client sends game chat messages normally
Flow=Client → Server AFGChatManager
Processing=Server subsystem forwards to Discord

; ===========================================================================================
; KEY COMPONENTS
; ===========================================================================================

[Component_ADiscordChatSubsystem]
Type=Mod Subsystem Actor
BaseClass=AModSubsystem
Purpose=Main controller for Discord integration
Spawning=Server only (SpawnOnServer policy)
Lifetime=Exists while server is running

[Component_UDiscordAPI]
Type=UObject
Purpose=Discord REST API wrapper
Operations=HTTP requests to Discord
Features=Send messages, poll messages, send notifications

[Component_UDiscordGateway]
Type=UObject (optional)
Purpose=Discord Gateway WebSocket client
Operations=Persistent WebSocket connection
Features=Bot presence, real-time updates
Requirement=WebSockets plugin

[Component_AFGChatManager]
Type=Game System
Source=Base Satisfactory game
Purpose=Manages in-game chat
Integration=Subsystem binds to OnChatMessageAdded event

; ===========================================================================================
; MESSAGE FLOW
; ===========================================================================================

[MessageFlow_DiscordToGame]
Direction=Discord to Satisfactory
Step1=Discord user types message in channel
Step2=Server polls Discord API (or receives via WebSocket)
Step3=DiscordAPI parses message
Step4=Subsystem formats message with DiscordNameFormat
Step5=Subsystem sends to AFGChatManager
Step6=ChatManager broadcasts to all clients
Step7=All players see message in game chat

[MessageFlow_GameToDiscord]
Direction=Satisfactory to Discord
Step1=Player types message in game
Step2=ChatManager fires OnChatMessageAdded event
Step3=Subsystem receives event callback
Step4=Subsystem formats message with GameNameFormat
Step5=Subsystem calls DiscordAPI to send message
Step6=DiscordAPI sends HTTP POST to Discord
Step7=Message appears in Discord channel

; ===========================================================================================
; NETWORK ARCHITECTURE
; ===========================================================================================

[Network_ServerOnly]
Architecture=Server-side only processing
DiscordConnection=Server has direct connection to Discord
ClientConnection=Clients have no Discord connection
Advantage1=No client-side setup required
Advantage2=No Discord credentials on clients
Advantage3=Centralized message processing
Advantage4=Reduced client resource usage

[Network_Replication]
GameChat=AFGChatManager handles chat replication
DiscordSubsystem=Not replicated to clients
MessageFlow=Server processes Discord messages then uses game chat system
ClientView=Clients see Discord messages as normal game chat

[Network_Bandwidth]
ServerToDiscord=HTTP requests for messages (minimal)
ServerToClients=Game chat replication (standard game traffic)
ClientToServer=Game chat messages (standard game traffic)
Additional=No additional client bandwidth for Discord

; ===========================================================================================
; SECURITY MODEL
; ===========================================================================================

[Security_BotToken]
Storage=Server configuration file only
ClientAccess=Never sent to clients
Exposure=Not in replicated data
Protection=Server-side only

[Security_ChannelID]
Storage=Server configuration file only
ClientKnowledge=Clients don't need to know channel ID
Exposure=Not in replicated data
Privacy=Discord channel remains server admin controlled

[Security_Messages]
Validation=Server validates all messages
Filtering=Server can implement filtering (future feature)
Control=Server has full control over message flow
ClientTrust=Clients trusted through normal game security

; ===========================================================================================
; COMPATIBILITY
; ===========================================================================================

[Compatibility_Vanilla]
VanillaClients=Can connect and play normally
ModRequired=Not required on client
SMLRequired=Not required on client
Experience=Full game functionality

[Compatibility_ModdedClients]
ModdedClients=Can also connect (mod not required)
OtherMods=Compatible with other client-side mods
Conflicts=None expected (server-side only)

[Compatibility_MultipleServers]
SameBot=Can use same bot for multiple servers
SeparateChannels=Use different channel IDs per server
Configuration=Each server has own config file
Isolation=Servers don't interfere with each other

; ===========================================================================================
; TROUBLESHOOTING ARCHITECTURE
; ===========================================================================================

[Troubleshooting_ClientRejected]
Issue=Clients being rejected despite RequiredOnRemote: false
Check1=Verify DiscordChatBridge.uplugin has RequiredOnRemote: false
Check2=Ensure field is in correct JSON structure
Check3=Rebuild mod after changing uplugin file
Check4=Check SML logs for mod loading messages

[Troubleshooting_SpawningOnClient]
Issue=Subsystem spawning on clients
Check1=Verify ReplicationPolicy set to SpawnOnServer
Check2=Check constructor in DiscordChatSubsystem.cpp
Check3=Ensure no replication code in subsystem
Check4=Review server logs for spawn messages

[Troubleshooting_MessagesNotAppearing]
Issue=Discord messages not appearing in game
Check1=Verify subsystem spawned on server
Check2=Check Discord API connection
Check3=Verify chat manager binding
Check4=Review message flow logs

; ===========================================================================================
; ADDITIONAL RESOURCES
; ===========================================================================================

[Resources]
SetupGuide=See SETUP_GUIDE.ini for configuration
Implementation=See IMPLEMENTATION_SUMMARY.ini for code details
Dependencies=See DEPENDENCY_EXPLANATION.ini for WebSockets info
Examples=See EXAMPLES.ini for configuration examples
